<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudAV Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {--primary: #667eea; --success: #2ed573; --danger: #ff4757;}
        body {background: linear-gradient(135deg, var(--primary), #764ba2); font-family: 'Segoe UI', sans-serif;}
        .glass {backdrop-filter: blur(20px); background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);}
        .metric-card {transition: all 0.3s; cursor: pointer;}
        .metric-card:hover {transform: translateY(-10px);}
    </style>
</head>
<body>
    <div class="container-fluid py-5">
        <div class="row mb-4">
            <div class="col">
                <h1 class="text-white mb-0"><i class="fas fa-shield-virus"></i> CloudAV Control Center</h1>
                <p class="text-white-50">Real-time threat protection across all platforms</p>
            </div>
        </div>

        <!-- Metrics -->
        <div class="row g-4 mb-5">
            <div class="col-lg-3 col-md-6">
                <div class="card glass metric-card text-white p-4 text-center" onclick="refreshStats()">
                    <i class="fas fa-search fa-3x mb-3 text-primary"></i>
                    <h2 id="scans">24.7K</h2>
                    <p class="mb-0">Scans Today</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card glass metric-card text-white p-4 text-center">
                    <i class="fas fa-check-circle fa-3x mb-3 text-success"></i>
                    <h2 id="clean">99.8%</h2>
                    <p class="mb-0">Clean Rate</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card glass metric-card text-white p-4 text-center">
                    <i class="fas fa-exclamation-triangle fa-3x mb-3 text-warning"></i>
                    <h2 id="threats">47</h2>
                    <p class="mb-0">Threats Blocked</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card glass metric-card text-white p-4 text-center">
                    <i class="fas fa-users fa-3x mb-3 text-info"></i>
                    <h2 id="agents">127</h2>
                    <p class="mb-0">Active Agents</p>
                </div>
            </div>
        </div>

        <!-- Charts & Controls -->
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card glass h-100">
                    <div class="card-header bg-transparent text-white">
                        <i class="fas fa-chart-line me-2"></i>Real-time Threat Activity
                    </div>
                    <div class="card-body p-0">
                        <canvas id="threatChart" height="100"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card glass h-100">
                    <div class="card-header bg-transparent text-white">Quick Actions</div>
                    <div class="card-body">
                        <div class="mb-4">
                            <input type="file" class="form-control form-control-lg" id="fileInput" multiple>
                            <button class="btn btn-success btn-lg w-100 mt-3" onclick="quickScan()">
                                <i class="fas fa-play"></i> Quick Scan
                            </button>
                        </div>
                        <button class="btn btn-warning btn-lg w-100 mb-3" onclick="fullScan()">
                            <i class="fas fa-hdd"></i> Full Scan
                        </button>
                        <div id="status" class="text-center p-3 bg-light rounded">
                            <i class="fas fa-circle text-success me-2"></i>Ready
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://your-app.railway.app'; // Ganti dengan URL deploy
        
        // WebSocket
        const ws = new WebSocket(`${API_URL.replace('https', 'wss')}/ws`);
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            updateThreats(data.threats);
        };

        // Charts
        const ctx = document.getElementById('threatChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{
                label: 'Threats Detected',
                data: [],
                borderColor: '#ff4757',
                backgroundColor: 'rgba(255,71,87,0.1)',
                tension: 0.4
            }] },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } },
                plugins: { legend: { labels: { color: 'white' } } }
            }
        });

        // Functions
        async function refreshStats() {
            try {
                const resp = await fetch(`${API_URL}/api/stats`);
                const stats = await resp.json();
                document.getElementById('scans').textContent = stats.total_scans.toLocaleString();
                document.getElementById('threats').textContent = stats.threats_found;
            } catch(e) {}
        }

        function quickScan() {
            const files = document.getElementById('fileInput').files;
            if(!files.length) return alert('Pilih file terlebih dahulu');
            
            document.getElementById('status').innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Scanning...';
            
            const formData = new FormData();
            formData.append('file', files[0]);
            
            fetch(`${API_URL}/api/scan`, { method: 'POST', body: formData })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('status').innerHTML = 
                        data.status === 'CLEAN' ? 
                        '<i class="fas fa-check-circle text-success me-2"></i>Clean!' :
                        '<i class="fas fa-exclamation-triangle text-danger me-2"></i>Threat Found!';
                });
        }

        function updateThreats(threats) {
            document.getElementById('threats').textContent = threats.length;
            chart.data.labels.push(new Date().toLocaleTimeString());
            chart.data.datasets[0].data.push(threats.length);
            if(chart.data.labels.length > 20) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }
            chart.update('none');
        }

        // Auto refresh
        setInterval(refreshStats, 5000);
        refreshStats();
    </script>
</body>
</html>
